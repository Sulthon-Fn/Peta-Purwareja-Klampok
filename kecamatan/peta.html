<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Peta Interaktif - Kecamatan Purwareja Klampok</title>
        <meta name="description" content="Peta interaktif berbasis WebGIS untuk Kecamatan Purwareja Klampok, Kabupaten Banjarnegara.">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <style>
            :root {
                --primary-color: #0F2C59;
                --secondary-color: #059669;
                --accent-color: #F59E0B;
                --light-bg: #F8FAFC;
                --text-dark: #1E293B;
                --text-light: #64748B;
            }
            *, *::before, *::after { box-sizing: border-box; }
            html { scroll-behavior: smooth; overflow-y: auto !important; height: auto; }
            body {
                margin: 0;
                font-family: 'Space Grotesk', sans-serif;
                line-height: 1.6;
                color: var(--text-dark);
                background: var(--light-bg);
                overflow-y: auto !important;
                height: auto;
            }
            
            /* Header */
            header {
                background: linear-gradient(135deg, var(--primary-color) 0%, #1a4080 100%);
                color: #fff;
                padding: 0 2rem;
                position: sticky;
                top: 0;
                z-index: 100;
                box-shadow: 0 4px 20px rgba(15, 44, 89, 0.15);
            }
            .nav-bar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                max-width: 1400px;
                margin: 0 auto;
                height: 70px;
            }
            .brand {
                display: flex;
                align-items: center;
                gap: 12px;
                font-weight: 600;
                font-size: 1.1rem;
            }
            .brand img {
                width: 40px;
                height: 40px;
                border-radius: 8px;
                object-fit: cover;
            }
            .menu-toggle { display: none; font-size: 1.5rem; background: none; color: #fff; border: none; cursor: pointer; }
            .menu { display: flex; gap: 8px; }
            .menu a {
                color: rgba(255,255,255,0.85);
                text-decoration: none;
                font-weight: 500;
                padding: 8px 16px;
                border-radius: 8px;
                transition: all 0.3s ease;
            }
            .menu a:hover { background: rgba(255,255,255,0.15); color: #fff; }
            
            @media (max-width: 768px) {
                .menu-toggle { display: block; }
                .menu { 
                    display: none; 
                    flex-direction: column; 
                    position: absolute; 
                    top: 70px; 
                    left: 0; 
                    right: 0;
                    background: var(--primary-color);
                    padding: 1rem;
                }
                .menu.show { display: flex; }
            }

            /* Page Title */
            .page-title {
                background: linear-gradient(135deg, var(--primary-color) 0%, #1a4080 100%);
                color: #fff;
                padding: 2rem;
                text-align: center;
            }
            .page-title h1 {
                margin: 0;
                font-size: 1.8rem;
                font-weight: 700;
            }
            .page-title p {
                margin: 0.5rem 0 0;
                opacity: 0.9;
                font-size: 1rem;
            }

            /* Map Container */
            .map-container {
                padding: 1.5rem;
                max-width: 1600px;
                margin: 0 auto;
            }
            .map-wrap {
                position: relative;
                background: #fff;
                border-radius: 16px;
                overflow: hidden;
                box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            }
            #map {
                width: 100%;
                height: calc(100vh - 200px);
                min-height: 500px;
            }
            
            /* Map Overlay Panel */
            .map-overlay {
                position: absolute;
                top: 10px;
                right: 10px;
                z-index: 1000;
            }
            .layer-drawer {
                background: rgba(255,255,255,0.98);
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                min-width: 280px;
                max-width: 320px;
                transition: all 0.3s ease;
            }
            .layer-drawer.collapsed .drawer-body { display: none; }
            .drawer-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 14px 16px;
                border-bottom: 1px solid #e2e8f0;
                cursor: pointer;
            }
            .drawer-title { font-weight: 600; color: var(--primary-color); margin: 0; font-size: 0.95rem; }
            .drawer-sub { font-size: 0.75rem; color: var(--text-light); margin: 0; }
            .drawer-toggle {
                background: var(--primary-color);
                color: #fff;
                border: none;
                border-radius: 6px;
                padding: 6px 10px;
                cursor: pointer;
                font-size: 1rem;
            }
            .drawer-body { padding: 12px 16px; max-height: 60vh; overflow-y: auto; }
            .layer-section { margin-bottom: 12px; }
            .layer-section-title { font-size: 0.75rem; color: var(--text-light); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
            .layer-toggle {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 6px 0;
                cursor: pointer;
                font-size: 0.85rem;
            }
            .layer-toggle input { width: 16px; height: 16px; accent-color: var(--secondary-color); }
            .layer-toggle .badge {
                margin-left: auto;
                font-size: 0.65rem;
                background: var(--secondary-color);
                color: #fff;
                padding: 2px 6px;
                border-radius: 20px;
            }
            
            /* Instruction Box */
            .instruction-box {
                background: linear-gradient(135deg, #f0fdf4 0%, #ecfeff 100%);
                border-left: 4px solid var(--secondary-color);
                padding: 1rem 1.5rem;
                margin-bottom: 1.5rem;
                border-radius: 0 12px 12px 0;
            }
            .instruction-box h3 {
                color: var(--secondary-color);
                margin: 0 0 0.5rem;
                font-size: 1rem;
            }
            .instruction-box p {
                margin: 0;
                color: var(--text-light);
                font-size: 0.9rem;
            }

            /* Footer */
            footer {
                background: var(--primary-color);
                color: rgba(255,255,255,0.8);
                text-align: center;
                padding: 1.5rem;
                font-size: 0.85rem;
            }

            /* Village Label Styling */
            .village-label {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
            }

            /* Popup Styling */
            .leaflet-popup-content-wrapper {
                border-radius: 12px !important;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
            }
            .leaflet-popup-content {
                margin: 12px 16px !important;
            }
        </style>
    </head>
    <body>
        <header>
            <div class="nav-bar">
                <div class="brand">
                    <img src="images/Banjarnegara.png" alt="Logo Kabupaten Banjarnegara">
                    <span>Geoportal Kec. Purwareja Klampok</span>
                </div>
                <button class="menu-toggle" aria-label="Toggle menu">‚ò∞</button>
                <nav class="menu" aria-label="Navigasi utama">
                    <a href="../index.html">üè† Beranda</a>
                    <a href="peta.html" style="background: rgba(255,255,255,0.15); color: #fff;">üó∫Ô∏è Peta Kecamatan</a>
                    <a href="../desa/peta.html">üèòÔ∏è Peta Desa Kecitran</a>
                </nav>
            </div>
        </header>

        <section class="page-title">
            <h1>üó∫Ô∏è Peta Interaktif Kecamatan Purwareja Klampok</h1>
            <p>Visualisasi spasial wilayah kecamatan dengan data desa-desa dan infrastruktur</p>
        </section>

        <main class="map-container">
            <div class="instruction-box">
                <h3>üìå Petunjuk Penggunaan</h3>
                <p>Gunakan fitur <strong>Layer Control</strong> (panel kanan) untuk menyaring informasi. Klik pada area desa untuk melihat detail. Arahkan kursor ke batas desa untuk highlight area.</p>
            </div>

            <div class="map-wrap">
                <div id="map"></div>
                <aside class="map-overlay">
                    <div class="layer-drawer collapsed" id="layerDrawer">
                        <div class="drawer-header">
                            <div>
                                <p class="drawer-title">Layer Control</p>
                                <p class="drawer-sub">Toggle layer peta</p>
                            </div>
                            <button class="drawer-toggle" id="drawerToggle" aria-label="Tampilkan panel">‚ò∞</button>
                        </div>

                        <div class="drawer-body">
                            <div class="layer-section">
                                <p class="layer-section-title">Basemap</p>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="basemap" checked disabled>
                                    <span>Google Satellite</span>
                                    <span class="badge">Aktif</span>
                                </label>
                            </div>

                            <div class="layer-section">
                                <p class="layer-section-title">Batas Administrasi</p>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="kecamatan" checked>
                                    <span>Batas Desa (Kecamatan)</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="desaKecitran">
                                    <span>Batas Desa Kecitran</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="batasRW">
                                    <span>Batas RW</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="dusun">
                                    <span>Dusun</span>
                                </label>
                            </div>

                            <div class="layer-section">
                                <p class="layer-section-title">Infrastruktur</p>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="jalan">
                                    <span>Jalan</span>
                                </label>
                            </div>

                            <div class="layer-section">
                                <p class="layer-section-title">Fasilitas</p>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="sekolah">
                                    <span>Sekolah</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="keagamaan">
                                    <span>Fasilitas Keagamaan</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="kantor">
                                    <span>Kantor</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="toko">
                                    <span>Toko</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="tempatMakan">
                                    <span>Tempat Makan</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="spbu">
                                    <span>SPBU</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="lapangan">
                                    <span>Lapangan</span>
                                </label>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="pemakaman">
                                    <span>Pemakaman</span>
                                </label>
                            </div>

                            <div class="layer-section">
                                <p class="layer-section-title">Lainnya</p>
                                <label class="layer-toggle">
                                    <input type="checkbox" data-layer-key="rumahSaya">
                                    <span>Posisi Rumah Pengembang</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </main>

        <footer>
            ¬© 2025 Sistem Informasi Geografis Kecamatan Purwareja Klampok. Dikembangkan oleh Sulthon FN (Universitas Amikom Purwokerto). Dibuat menggunakan QGIS &amp; Leaflet JS.
        </footer>

        <script>
            // Menu toggle
            const toggle = document.querySelector('.menu-toggle');
            const menu = document.querySelector('.menu');
            if (toggle && menu) {
                toggle.addEventListener('click', () => menu.classList.toggle('show'));
            }

            // Layer drawer toggle
            const drawerToggle = document.getElementById('drawerToggle');
            const layerDrawer = document.getElementById('layerDrawer');
            if (drawerToggle && layerDrawer) {
                drawerToggle.addEventListener('click', () => {
                    layerDrawer.classList.toggle('collapsed');
                });
            }
        </script>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/multi-style-layer.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <!-- Data files -->
        <script src="data/PurwarejaKlampok_1.js"></script>
        <script src="data/batasdesakecitran_8.js"></script>
        <script src="data/BatasRW_12.js"></script>
        <script src="data/Dusun_17.js"></script>
        <script src="data/Jalan_18.js"></script>
        <script src="data/Sekolah_22.js"></script>
        <script src="data/FasilitasKeagamaan_27.js"></script>
        <script src="data/Kantor_26.js"></script>
        <script src="data/Toko_19.js"></script>
        <script src="data/TempatMakan_20.js"></script>
        <script src="data/SPBU_21.js"></script>
        <script src="data/Lapangan_25.js"></script>
        <script src="data/Pemakaman_24.js"></script>
        <script src="data/RumahSaya_23.js"></script>
        <script src="data/PosisiRumahSaya_14.js"></script>
        <script>
        // ========== Map Initialization ==========
        var map = L.map('map', {
            zoomControl: false, 
            maxZoom: 28, 
            minZoom: 1
        }).setView([-7.474, 109.455], 14);

        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        
        // Popup helper functions
        function removeEmptyRowsFromPopupContent(content, feature) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var rows = tempDiv.querySelectorAll('tr');
            for (var i = 0; i < rows.length; i++) {
                var td = rows[i].querySelector('td.visible-with-data');
                var key = td ? td.id : '';
                if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                    rows[i].parentNode.removeChild(rows[i]);
                }
            }
            return tempDiv.innerHTML;
        }

        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() { popup.update(); }, 10);
                }
            }
        }

        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);

        L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);

        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';

        var bounds_group = new L.featureGroup([]);

        // ========== Basemap Layer ==========
        map.createPane('pane_GoogleSatellite_0');
        map.getPane('pane_GoogleSatellite_0').style.zIndex = 400;
        var layer_GoogleSatellite_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            pane: 'pane_GoogleSatellite_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
        });
        map.addLayer(layer_GoogleSatellite_0);

        // ========== Hover Style for Boundaries ==========
        var hoverStyle = {
            weight: 5,
            color: '#F59E0B',
            opacity: 1,
            fillOpacity: 0.5,
            fillColor: '#F59E0B'
        };

        var originalStyles = {};

        // ========== Village Boundaries Layer (PurwarejaKlampok_1) ==========
        function pop_PurwarejaKlampok_1(feature, layer) {
            var popupContent = '<table style="font-family: Space Grotesk, sans-serif;">\
                    <tr>\
                        <th scope="row" style="padding: 8px; background: #0F2C59; color: white;">Nama Desa</th>\
                        <td style="padding: 8px; font-weight: 600;">' + (feature.properties['NAMOBJ'] !== null ? feature.properties['NAMOBJ'] : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row" style="padding: 8px; background: #f1f5f9;">Kecamatan</th>\
                        <td style="padding: 8px;">' + (feature.properties['WADMKC'] !== null ? feature.properties['WADMKC'] : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row" style="padding: 8px; background: #f1f5f9;">Kabupaten</th>\
                        <td style="padding: 8px;">' + (feature.properties['WADMKK'] !== null ? feature.properties['WADMKK'] : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row" style="padding: 8px; background: #f1f5f9;">Provinsi</th>\
                        <td style="padding: 8px;">' + (feature.properties['WADMPR'] !== null ? feature.properties['WADMPR'] : '') + '</td>\
                    </tr>\
                </table>';
            
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function(e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });

            // Mouse hover effects
            layer.on('mouseover', function(e) {
                var target = e.target;
                originalStyles[L.stamp(target)] = {
                    weight: target.options.weight,
                    color: target.options.color,
                    opacity: target.options.opacity,
                    fillOpacity: target.options.fillOpacity,
                    fillColor: target.options.fillColor
                };
                target.setStyle(hoverStyle);
                target.bringToFront();
            });

            layer.on('mouseout', function(e) {
                var target = e.target;
                var key = L.stamp(target);
                if (originalStyles[key]) {
                    target.setStyle(originalStyles[key]);
                    delete originalStyles[key];
                }
            });
        }

        // Village colors based on name
        var villageColors = {
            'Kalimandi': '#4CAF50',
            'Klampok': '#2196F3',
            'Kalilandak': '#9C27B0',
            'Purwareja': '#FF9800',
            'Pagak': '#00BCD4',
            'Sirkandi': '#E91E63',
            'Kecitran': '#8BC34A',
            'Kaliwinasuh': '#795548'
        };

        function style_PurwarejaKlampok_1(feature) {
            var villageName = feature.properties['NAMOBJ'];
            var fillColor = villageColors[villageName] || '#666666';
            
            return {
                pane: 'pane_PurwarejaKlampok_1',
                opacity: 0.9,
                color: '#ffffff',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.5,
                fill: true,
                fillOpacity: 0.35,
                fillColor: fillColor,
                interactive: true,
            }
        }

        map.createPane('pane_PurwarejaKlampok_1');
        map.getPane('pane_PurwarejaKlampok_1').style.zIndex = 401;
        
        var layer_PurwarejaKlampok_1 = new L.geoJson(json_PurwarejaKlampok_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_PurwarejaKlampok_1',
            layerName: 'layer_PurwarejaKlampok_1',
            pane: 'pane_PurwarejaKlampok_1',
            onEachFeature: pop_PurwarejaKlampok_1,
            style: style_PurwarejaKlampok_1,
        });
        bounds_group.addLayer(layer_PurwarejaKlampok_1);
        map.addLayer(layer_PurwarejaKlampok_1);

        // Add village name labels
        layer_PurwarejaKlampok_1.eachLayer(function(layer) {
            if (layer.feature && layer.feature.properties['NAMOBJ']) {
                layer.bindTooltip(
                    '<div style="color: #fff; font-size: 11pt; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.9), -1px -1px 2px rgba(0,0,0,0.5);">' + 
                    layer.feature.properties['NAMOBJ'] + 
                    '</div>', 
                    {
                        permanent: true, 
                        direction: 'center',
                        className: 'village-label'
                    }
                );
            }
        });

        // ========== Desa Kecitran Boundary ==========
        map.createPane('pane_desaKecitran');
        map.getPane('pane_desaKecitran').style.zIndex = 402;
        
        var layer_desaKecitran = new L.geoJson(json_batasdesakecitran_8, {
            pane: 'pane_desaKecitran',
            style: function() {
                return {
                    color: '#FF5722',
                    weight: 3,
                    fillOpacity: 0.1,
                    fillColor: '#FF5722'
                };
            },
            onEachFeature: function(feature, layer) {
                var popupContent = '<table style="font-family: Space Grotesk, sans-serif;">\
                    <tr>\
                        <th style="padding: 8px; background: #0F2C59; color: white;">Nama Desa</th>\
                        <td style="padding: 8px; font-weight: 600;">' + (feature.properties['Nama'] || 'Kecitran') + '</td>\
                    </tr>\
                    <tr>\
                        <th style="padding: 8px; background: #f1f5f9;">Luas</th>\
                        <td style="padding: 8px;">' + (feature.properties['luas'] || '¬± 241 Ha') + '</td>\
                    </tr>\
                    <tr>\
                        <th style="padding: 8px; background: #f1f5f9;">Jumlah Penduduk</th>\
                        <td style="padding: 8px;">' + (feature.properties['jml pend'] || '¬± 3.500 Jiwa') + '</td>\
                    </tr>\
                    <tr>\
                        <th style="padding: 8px; background: #f1f5f9;">Jumlah Dusun</th>\
                        <td style="padding: 8px;">' + (feature.properties['jml dusun'] || '3 Dusun') + '</td>\
                    </tr>\
                    <tr>\
                        <th style="padding: 8px; background: #f1f5f9;">Jumlah RW</th>\
                        <td style="padding: 8px;">' + (feature.properties['jml rw'] || '5 RW') + '</td>\
                    </tr>\
                    <tr>\
                        <th style="padding: 8px; background: #f1f5f9;">Jumlah RT</th>\
                        <td style="padding: 8px;">' + (feature.properties['jml rt'] || '31 RT') + '</td>\
                    </tr>\
                </table>';
                layer.bindPopup(popupContent);
                
                layer.on('mouseover', function(e) {
                    e.target.setStyle({
                        weight: 5,
                        color: '#F59E0B',
                        fillOpacity: 0.3
                    });
                });
                layer.on('mouseout', function(e) {
                    e.target.setStyle({
                        color: '#FF5722',
                        weight: 3,
                        fillOpacity: 0.1
                    });
                });
            }
        });

        // ========== Batas RW ==========
        map.createPane('pane_batasRW');
        map.getPane('pane_batasRW').style.zIndex = 403;
        
        var layer_batasRW = new L.geoJson(json_BatasRW_12, {
            pane: 'pane_batasRW',
            style: function() {
                return {
                    color: '#FFEB3B',
                    weight: 2,
                    fillOpacity: 0.05,
                    fillColor: '#FFEB3B',
                    dashArray: '5,5'
                };
            }
        });

        // ========== Dusun ==========
        map.createPane('pane_dusun');
        map.getPane('pane_dusun').style.zIndex = 404;
        
        var layer_dusun = new L.geoJson(json_Dusun_17, {
            pane: 'pane_dusun',
            style: function() {
                return {
                    color: '#9C27B0',
                    weight: 2,
                    fillOpacity: 0.1,
                    fillColor: '#9C27B0'
                };
            }
        });

        // ========== Jalan ==========
        map.createPane('pane_jalan');
        map.getPane('pane_jalan').style.zIndex = 410;
        
        var layer_jalan = new L.geoJson(json_Jalan_18, {
            pane: 'pane_jalan',
            style: function() {
                return {
                    color: '#FFC107',
                    weight: 2,
                    opacity: 0.8
                };
            }
        });

        // ========== Point Layers ==========
        function createPointLayer(data, pane, iconHtml, popupFields) {
            map.createPane(pane);
            map.getPane(pane).style.zIndex = 500;
            
            return L.geoJson(data, {
                pane: pane,
                pointToLayer: function(feature, latlng) {
                    return L.marker(latlng, {
                        icon: L.divIcon({
                            html: iconHtml,
                            className: 'custom-marker',
                            iconSize: [24, 24],
                            iconAnchor: [12, 12]
                        })
                    });
                },
                onEachFeature: function(feature, layer) {
                    var content = '<table style="font-family: Space Grotesk, sans-serif;">';
                    popupFields.forEach(function(field) {
                        if (feature.properties[field]) {
                            content += '<tr><th style="padding: 4px 8px; background: #f1f5f9;">' + field + '</th><td style="padding: 4px 8px;">' + feature.properties[field] + '</td></tr>';
                        }
                    });
                    content += '</table>';
                    layer.bindPopup(content);
                }
            });
        }

        // Sekolah
        var layer_sekolah = createPointLayer(json_Sekolah_22, 'pane_sekolah', '<div style="background:#4CAF50;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">üè´</div>', ['nama', 'jenis', 'alamat']);

        // Fasilitas Keagamaan
        var layer_keagamaan = createPointLayer(json_FasilitasKeagamaan_27, 'pane_keagamaan', '<div style="background:#9C27B0;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">üïå</div>', ['nama', 'jenis', 'alamat']);

        // Kantor
        var layer_kantor = createPointLayer(json_Kantor_26, 'pane_kantor', '<div style="background:#2196F3;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">üè¢</div>', ['nama', 'jenis', 'alamat']);

        // Toko
        var layer_toko = createPointLayer(json_Toko_19, 'pane_toko', '<div style="background:#FF9800;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">üè™</div>', ['nama', 'jenis', 'alamat']);

        // Tempat Makan
        var layer_tempatMakan = createPointLayer(json_TempatMakan_20, 'pane_tempatMakan', '<div style="background:#E91E63;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">üçΩÔ∏è</div>', ['nama', 'jenis', 'alamat']);

        // SPBU
        var layer_spbu = createPointLayer(json_SPBU_21, 'pane_spbu', '<div style="background:#F44336;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">‚õΩ</div>', ['nama', 'alamat']);

        // Lapangan
        var layer_lapangan = createPointLayer(json_Lapangan_25, 'pane_lapangan', '<div style="background:#00BCD4;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">üèüÔ∏è</div>', ['nama', 'jenis', 'alamat']);

        // Pemakaman
        var layer_pemakaman = createPointLayer(json_Pemakaman_24, 'pane_pemakaman', '<div style="background:#607D8B;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">‚ö∞Ô∏è</div>', ['nama', 'alamat']);

        // Rumah Saya
        var layer_rumahSaya = createPointLayer(json_RumahSaya_23, 'pane_rumahSaya', '<div style="background:#F59E0B;color:#fff;padding:4px;border-radius:50%;font-size:12px;text-align:center;">üè†</div>', ['nama', 'keterangan']);

        // ========== Layer Toggle Functionality ==========
        var layers = {
            'kecamatan': layer_PurwarejaKlampok_1,
            'desaKecitran': layer_desaKecitran,
            'batasRW': layer_batasRW,
            'dusun': layer_dusun,
            'jalan': layer_jalan,
            'sekolah': layer_sekolah,
            'keagamaan': layer_keagamaan,
            'kantor': layer_kantor,
            'toko': layer_toko,
            'tempatMakan': layer_tempatMakan,
            'spbu': layer_spbu,
            'lapangan': layer_lapangan,
            'pemakaman': layer_pemakaman,
            'rumahSaya': layer_rumahSaya
        };

        var layerToggles = document.querySelectorAll('[data-layer-key]');
        layerToggles.forEach(function(toggle) {
            toggle.addEventListener('change', function() {
                var layerKey = this.getAttribute('data-layer-key');
                if (layers[layerKey]) {
                    if (this.checked) {
                        map.addLayer(layers[layerKey]);
                    } else {
                        map.removeLayer(layers[layerKey]);
                    }
                }
            });
        });

        // Fit map to show all villages
        map.fitBounds(layer_PurwarejaKlampok_1.getBounds(), {
            padding: [40, 40]
        });
        </script>        
    </body>
</html>
